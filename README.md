# Ansible role: Virtual Host

Basically an ansible wrapper for acro-add-website.sh, geared for sites using LetsEncrypt certificates.

## Requirements

- The acro infrastructure utilities must already be installed on the server
- Acro-add-website.sh must already be installed AND configured on the server
- LetsEncrypt installed, configured, and working

## Role Variables

#### Required Variables

**linux_owner**: The name of the user account to create

**project**: The dir name for the project inside the linux owner's home dir. Usually should be the same as linux owner, unless the owner has more than one site or project.

**nginx_primal_name**: This is the initial / internal name of the site so it can be staged ... e.g project.host.example.com

**nginx_canonical_name**: Once a site is launched, the final destination name for the site. E.g. www.bigcorp.com

**nginx_aliases**: Once a site is launched, a list of any other virtual host names that the site should respond to. These will all redirect to the canonical name.

**php_version**: Major.minor version - Caveat: this version must be installed on the server.

**web_root_dir_name**: Can be anything - The convention is to use 'web' for Drupal >= 8 sites, or 'wwwroot' for < D8 or other non drupal sites.

**letsencrypt_canonical** (boolean): Should be `false` until you're ready to put the site in to production and have the DNS names for the site pointed at the machine. When set to `true`, the scripts will attempt to add the site's canonical name and nginx_aliases to the LetsEncrypt SSL certificate.

#### Optional variables

**nginx_canonical_template**: Not required unless you're using a custom NGINX template ... Caveat - the role doesn't support external templates (yet).

**redirect_code**: Defaults to 302 (temporary). After your site has launched and working without any issues, change this to 301 and run your playbook again to make redirects [to the canoncial name] permanent.

**responsible_person**: Defaults to `root`. This adds a line to to postfix's /etc/aliases file. Who should receive messages from the system (usually generated by Cron) about this site? Can either be the name of a local linux user, or an email address.

**See also**: defaults/main.yml

## Dependencies

None

## Example Playbook

```yaml
- hosts: servers
  roles:
    - name: Configure the site for bigcorp
      role: acromedia.virtual-host
      linux_owner: bigcorp
      project: bigcorp
      nginx_primal_name: bigcorp.host.example.com
      nginx_canonical_name: www.bigcorp.com
      nginx_aliases:
        - bigcorp.com
      php_version: 7.1
      web_root_dir_name: web
      letsencrypt_canonical: false
      nginx_canonical_template: etc/nginx/sites-available/ACCCOUNT_PROJECT.le-ssl.conf.j2
      redirect_code: 302
```

## License

For Acro Media internal use only.

## Author Information

Acro Media Inc.
